var YouTubeMusicPlayer=function(t){"use strict";var e=(t=>(t[t.UNSTARTED=-1]="UNSTARTED",t[t.ENDED=0]="ENDED",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.BUFFERING=3]="BUFFERING",t[t.CUED=5]="CUED",t))(e||{}),s=(t=>(t.NONE="none",t.ONE="one",t.ALL="all",t))(s||{}),a=(t=>(t.INVALID_VIDEO_ID="INVALID_VIDEO_ID",t.VIDEO_NOT_FOUND="VIDEO_NOT_FOUND",t.VIDEO_NOT_EMBEDDABLE="VIDEO_NOT_EMBEDDABLE",t.NETWORK_ERROR="NETWORK_ERROR",t.API_ERROR="API_ERROR",t.STORAGE_ERROR="STORAGE_ERROR",t))(a||{});function i(t){const e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/(?:m\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,/(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/],s=t.trim();for(const a of e){const t=s.match(a);if(t&&t[1])return{isValid:!0,videoId:t[1]}}return{isValid:!1,error:"Invalid YouTube URL or Video ID"}}function r(t,e="medium"){return`https://img.youtube.com/vi/${t}/${{default:"default",medium:"mqdefault",high:"hqdefault",standard:"sddefault",maxres:"maxresdefault"}[e]}.jpg`}const l=new class{constructor(){this.state={loaded:!1,loading:!1},this.loadPromise=null,this.callbacks=[]}async loadAPI(){return this.state.loaded?Promise.resolve():(this.state.loading&&this.loadPromise||(this.state.loading=!0,this.loadPromise=new Promise((t,e)=>{if(window.YT&&window.YT.Player)return this.state.loaded=!0,this.state.loading=!1,void t();const s=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{this.state.loaded=!0,this.state.loading=!1,this.callbacks.forEach(t=>t()),this.callbacks=[],s&&s(),t()};const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api",a.onerror=()=>{this.state.loading=!1,this.state.error="Failed to load YouTube API",e(new Error("Failed to load YouTube API"))};const i=document.getElementsByTagName("script")[0];i&&i.parentNode?i.parentNode.insertBefore(a,i):document.head.appendChild(a),setTimeout(()=>{this.state.loading&&(this.state.loading=!1,this.state.error="YouTube API load timeout",e(new Error("YouTube API load timeout")))},1e4)})),this.loadPromise)}isReady(){return this.state.loaded&&!(!window.YT||!window.YT.Player)}async waitForReady(){return this.isReady()?Promise.resolve():(this.state.loading||this.state.loaded||await this.loadAPI(),new Promise(t=>{this.isReady()?t():this.callbacks.push(t)}))}getState(){return{...this.state}}};function n(t,e){let s;return(...a)=>{clearTimeout(s),s=window.setTimeout(()=>t(...a),e)}}class o{constructor(t="ytMusicPlayer"){this.prefix=t}save(t,e){try{const s=JSON.stringify(e),a=this.getFullKey(t);localStorage.setItem(a,s)}catch(s){throw console.warn("Failed to save to localStorage:",s),new Error(`Storage save failed: ${s}`)}}load(t){try{const e=this.getFullKey(t),s=localStorage.getItem(e);return null===s?null:JSON.parse(s)}catch(e){return console.warn("Failed to load from localStorage:",e),null}}remove(t){try{const e=this.getFullKey(t);localStorage.removeItem(e)}catch(e){console.warn("Failed to remove from localStorage:",e)}}clear(){try{const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s&&s.startsWith(this.prefix+":")&&t.push(s)}t.forEach(t=>localStorage.removeItem(t))}catch(t){console.warn("Failed to clear localStorage:",t)}}isAvailable(){try{const t="__localStorage_test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch{return!1}}getUsageInfo(){if(!this.isAvailable())return{used:0,available:0,percentage:0};try{let t=0;for(let a=0;a<localStorage.length;a++){const e=localStorage.key(a);if(e){const s=localStorage.getItem(e);t+=e.length+((null==s?void 0:s.length)||0)}}const e=5242880,s=t/e*100;return{used:t,available:e-t,percentage:Math.min(s,100)}}catch{return{used:0,available:0,percentage:0}}}getFullKey(t){return`${this.prefix}:${t}`}}class h{constructor(t,e="ytMusicPlayer"){this.stateKey="playerState",this.storage=t||new o(e)}saveState(t){try{const e={...t,lastUpdated:t.lastUpdated.toISOString(),playlist:{...t.playlist,tracks:t.playlist.tracks.map(t=>({...t,addedAt:t.addedAt.toISOString()}))}};this.storage.save(this.stateKey,e)}catch(e){console.warn("Failed to save player state:",e)}}loadState(){try{const t=this.storage.load(this.stateKey);return t?{...t,lastUpdated:new Date(t.lastUpdated),playlist:{...t.playlist,tracks:t.playlist.tracks.map(t=>({...t,addedAt:new Date(t.addedAt)}))}}:null}catch(t){return console.warn("Failed to load player state:",t),null}}savePlaylist(t){try{const e=this.loadState();e&&(e.playlist=t,e.lastUpdated=new Date,this.saveState(e))}catch(e){console.warn("Failed to save playlist:",e)}}saveCurrentTime(t){try{const e=this.loadState();e&&(e.currentTime=t,e.lastUpdated=new Date,this.saveState(e))}catch(e){console.warn("Failed to save current time:",e)}}saveSettings(t){try{const e=this.loadState();e&&(e.settings=t,e.lastUpdated=new Date,this.saveState(e))}catch(e){console.warn("Failed to save settings:",e)}}clearState(){try{this.storage.remove(this.stateKey)}catch(t){console.warn("Failed to clear player state:",t)}}isStorageAvailable(){return!(this.storage instanceof o)||this.storage.isAvailable()}migrateData(t="ytMusicPlayer"){try{const e=localStorage.getItem(t);if(!e)return!1;const s=JSON.parse(e);return!(!s||"object"!=typeof s)&&(this.storage.save(this.stateKey,s),localStorage.removeItem(t),!0)}catch(e){return console.warn("Failed to migrate data:",e),!1}}}const d=new h;class u{constructor(t){this.player=null,this.playlist={tracks:[],currentIndex:0,shuffled:!1},this.settings={volume:80,repeatMode:s.ALL,shuffled:!1,autoplay:!1},this.currentTime=0,this.isReady=!1,this.eventListeners=new Map,this.containerId=t.containerId,this.storage=!1!==t.saveState?d:new h,void 0!==t.volume&&(this.settings.volume=t.volume),void 0!==t.repeat&&(this.settings.repeatMode=t.repeat),void 0!==t.shuffle&&(this.settings.shuffled=t.shuffle),void 0!==t.autoplay&&(this.settings.autoplay=t.autoplay),this.debouncedSaveState=n(()=>this.saveCurrentState(),1e3),this.debouncedTimeUpdate=n(()=>this.debouncedSaveState(),2e3),this.initialize()}async initialize(){try{this.loadStoredState(),await l.waitForReady(),this.ensureContainer(),this.createPlayer(),this.emit("ready",{player:this})}catch(t){this.handleError({type:a.API_ERROR,message:"Failed to initialize player",originalError:t})}}ensureContainer(){let t=document.getElementById(this.containerId);t||(t=document.createElement("div"),t.id=this.containerId,t.style.cssText="width: 0; height: 0; overflow: hidden; position: absolute;",document.body.appendChild(t))}createPlayer(){const t={height:0,width:0,playerVars:{autoplay:0,controls:0,disablekb:1,enablejsapi:1,iv_load_policy:3,modestbranding:1,playsinline:1,rel:0,origin:window.location.origin},events:{onReady:t=>this.handlePlayerReady(t),onStateChange:t=>this.handlePlayerStateChange(t),onError:t=>this.handlePlayerError(t)}};this.player=new window.YT.Player(this.containerId,t)}handlePlayerReady(t){var e;this.isReady=!0,null==(e=this.player)||e.setVolume(this.settings.volume),this.startTimeMonitoring(),this.playlist.tracks.length>0&&this.loadCurrentTrack(),this.emit("ready",{player:this})}handlePlayerStateChange(t){const s=t.data;this.emit("stateChange",{state:s,isPlaying:s===e.PLAYING,isPaused:s===e.PAUSED,isEnded:s===e.ENDED}),s===e.ENDED&&this.handleTrackEnded(),s===e.PLAYING&&this.debouncedSaveState()}handlePlayerError(t){const e=t.data,s=this.getCurrentTrack(),i=function(t,e){const s={2:{type:a.INVALID_VIDEO_ID,message:"The video ID is invalid or contains invalid characters."},5:{type:a.API_ERROR,message:"The requested content cannot be played in an HTML5 player."},100:{type:a.VIDEO_NOT_FOUND,message:"The video was not found or has been removed."},101:{type:a.VIDEO_NOT_EMBEDDABLE,message:"The video owner does not allow it to be played in embedded players."},150:{type:a.VIDEO_NOT_EMBEDDABLE,message:"The video owner does not allow it to be played in embedded players."}}[t]||{type:a.API_ERROR,message:`Unknown YouTube API error: ${t}`};return{type:s.type,message:s.message,...e&&{videoId:e},originalError:t}}(e,null==s?void 0:s.id);this.handleError(i),[100,101,150].includes(e)&&this.playlist.tracks.length>1&&this.next()}handleTrackEnded(){this.settings.repeatMode===s.ONE?(this.seekTo(0),this.play()):this.next()}startTimeMonitoring(){const t=()=>{this.player&&this.isReady&&(this.currentTime=this.player.getCurrentTime(),this.handleTimeUpdate()),requestAnimationFrame(t)};t()}handleTimeUpdate(){this.emit("timeUpdate",{currentTime:this.currentTime,duration:this.getDuration(),progress:this.getProgress()}),this.debouncedTimeUpdate()}async addTrack(t,e){const s=i(t);if(!s.isValid||!s.videoId)return this.handleError({type:a.INVALID_VIDEO_ID,message:"Invalid YouTube URL"}),null;const l={id:s.videoId,title:e||`Video ${s.videoId}`,duration:0,thumbnail:r(s.videoId),url:t,addedAt:new Date};return this.playlist.tracks.push(l),1===this.playlist.tracks.length&&(this.playlist.currentIndex=0,this.loadCurrentTrack()),this.emit("playlistChange",{playlist:this.playlist,action:"add",track:l}),this.debouncedSaveState(),l}async addTrackWithMetadata(t){const e={id:t.id,title:t.title,artist:t.artist,tags:t.tags,duration:t.duration||0,thumbnail:r(t.id),url:`https://youtu.be/${t.id}`,addedAt:new Date};return this.playlist.tracks.push(e),1===this.playlist.tracks.length&&(this.playlist.currentIndex=0,this.loadCurrentTrack()),this.emit("playlistChange",{playlist:this.playlist,action:"add",track:e}),this.debouncedSaveState(),e}removeTrack(t){if(t<0||t>=this.playlist.tracks.length)return!1;const e=this.playlist.tracks[t];return this.playlist.tracks.splice(t,1),t<this.playlist.currentIndex?this.playlist.currentIndex--:t===this.playlist.currentIndex&&(0===this.playlist.tracks.length?(this.playlist.currentIndex=0,this.stop()):(this.playlist.currentIndex>=this.playlist.tracks.length&&(this.playlist.currentIndex=0),this.loadCurrentTrack())),this.emit("playlistChange",{playlist:this.playlist,action:"remove",track:e,index:t}),this.debouncedSaveState(),!0}loadCurrentTrack(){const t=this.getCurrentTrack();t&&this.player&&this.isReady&&(this.player.loadVideoById(t.id,this.currentTime),this.emit("trackChange",{track:t,index:this.playlist.currentIndex,playlist:this.playlist}))}play(){this.player&&this.isReady&&this.player.playVideo()}pause(){this.player&&this.isReady&&this.player.pauseVideo()}stop(){this.player&&this.isReady&&(this.player.stopVideo(),this.currentTime=0)}togglePlay(){if(!this.player||!this.isReady)return;this.player.getPlayerState()===e.PLAYING?this.pause():this.play()}next(){if(0===this.playlist.tracks.length)return;let t;if(this.settings.shuffled&&this.playlist.shuffleOrder){const e=(this.playlist.shuffleOrder.indexOf(this.playlist.currentIndex)+1)%this.playlist.shuffleOrder.length;t=this.playlist.shuffleOrder[e]}else t=(this.playlist.currentIndex+1)%this.playlist.tracks.length;this.jumpToTrack(t)}previous(){if(0===this.playlist.tracks.length)return;let t;if(this.settings.shuffled&&this.playlist.shuffleOrder){const e=this.playlist.shuffleOrder.indexOf(this.playlist.currentIndex),s=0===e?this.playlist.shuffleOrder.length-1:e-1;t=this.playlist.shuffleOrder[s]}else t=0===this.playlist.currentIndex?this.playlist.tracks.length-1:this.playlist.currentIndex-1;this.jumpToTrack(t)}jumpToTrack(t){t<0||t>=this.playlist.tracks.length||(this.playlist.currentIndex=t,this.currentTime=0,this.loadCurrentTrack(),this.settings.autoplay&&this.play())}seekTo(t){this.player&&this.isReady&&(this.player.seekTo(t),this.currentTime=t)}setVolume(t){t=Math.max(0,Math.min(100,t)),this.settings.volume=t,this.player&&this.isReady&&this.player.setVolume(t),this.emit("volumeChange",{volume:t}),this.debouncedSaveState()}toggleMute(){this.player&&this.isReady&&(this.player.isMuted()?this.player.unMute():this.player.mute())}toggleShuffle(){this.settings.shuffled=!this.settings.shuffled,this.settings.shuffled?this.playlist.shuffleOrder=function(t,e){const s=Array.from({length:t},(t,e)=>e);for(let a=s.length-1;a>0;a--){const t=Math.floor(Math.random()*(a+1));[s[a],s[t]]=[s[t],s[a]]}if(void 0!==e&&e>=0&&e<t){const t=s.indexOf(e);t>0&&([s[0],s[t]]=[s[t],s[0]])}return s}(this.playlist.tracks.length,this.playlist.currentIndex):this.playlist.shuffleOrder=void 0,this.emit("settingsChange",{settings:this.settings}),this.debouncedSaveState()}toggleRepeat(){const t=[s.NONE,s.ALL,s.ONE],e=(t.indexOf(this.settings.repeatMode)+1)%t.length;this.settings.repeatMode=t[e],this.emit("settingsChange",{settings:this.settings}),this.debouncedSaveState()}clearPlaylist(){this.playlist.tracks=[],this.playlist.currentIndex=0,this.playlist.shuffleOrder=void 0,this.stop(),this.emit("playlistChange",{playlist:this.playlist,action:"clear"}),this.debouncedSaveState()}getCurrentTrack(){return this.playlist.tracks[this.playlist.currentIndex]||null}getPlaylist(){return{...this.playlist}}getSettings(){return{...this.settings}}getCurrentTime(){return this.currentTime}getDuration(){var t;return(null==(t=this.player)?void 0:t.getDuration())||0}getProgress(){const t=this.getDuration();return t>0?this.currentTime/t*100:0}getVolume(){return this.settings.volume}isPlaying(){var t;return(null==(t=this.player)?void 0:t.getPlayerState())===e.PLAYING}isPaused(){var t;return(null==(t=this.player)?void 0:t.getPlayerState())===e.PAUSED}isMuted(){var t;return(null==(t=this.player)?void 0:t.isMuted())||!1}on(t,e){var s;this.eventListeners.has(t)||this.eventListeners.set(t,[]),null==(s=this.eventListeners.get(t))||s.push(e)}off(t,e){const s=this.eventListeners.get(t);if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}emit(t,e){const s=this.eventListeners.get(t);s&&s.forEach(t=>{try{t(e)}catch(s){console.warn("Event handler error:",s)}})}handleError(t){console.error("Player error:",t),this.emit("error",t)}saveCurrentState(){if(!this.storage)return;const t={playlist:this.playlist,currentTime:this.currentTime,settings:this.settings,lastUpdated:new Date};this.storage.saveState(t)}loadStoredState(){if(!this.storage)return;const t=this.storage.loadState();t&&(this.playlist=t.playlist,this.currentTime=t.currentTime,this.settings=t.settings)}destroy(){this.player&&(this.player.destroy(),this.player=null),this.eventListeners.clear(),this.isReady=!1}}return t.ErrorType=a,t.LocalStorageManager=o,t.PlayerState=e,t.PlayerStorageManager=h,t.RepeatMode=s,t.YouTubeMusicPlayer=u,t.default=u,t.defaultStorage=d,t.extractVideoId=i,t.formatTime=function(t){if(isNaN(t)||t<0)return"0:00";const e=Math.floor(t/3600),s=Math.floor(t%3600/60),a=Math.floor(t%60);return e>0?`${e}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${s}:${a.toString().padStart(2,"0")}`},t.getThumbnailUrl=r,t.isValidYouTubeUrl=function(t){return i(t).isValid},t.parseTime=function(t){const e=t.split(":").map(t=>parseInt(t,10)).filter(t=>!isNaN(t));return 2===e.length?60*(e[0]||0)+(e[1]||0):3===e.length?3600*(e[0]||0)+60*(e[1]||0)+(e[2]||0):0},t.youtubeAPI=l,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),t}({});
//# sourceMappingURL=youtube-music-player.iife.js.map
